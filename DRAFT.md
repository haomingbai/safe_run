# 项目草案：基于 KVM MicroVM 的策略驱动安全执行与审计系统（Safe-Run Suite）

## 0. 总体策略（保证软著/专利可写）

* **软件著作权**：优先覆盖你自己实现的“策略引擎 + 安全编排 + 审计证据链 + 可运维工具链”，而不是 Firecracker/KVM 本身。
* **专利**：围绕“**策略→可证明配置**”与“**可审计证据链**”的组合机制，提出一种可落地的**方法/系统**（强调自动化、约束、证据链与风险控制）。
* **关键点**：你做的是“安全执行系统与方法”，而不是“调用 Firecracker 跑程序”。要在计划里明确你的原创性模块与技术效果。

---

## 1. 明确目标与交付边界

### 1.1 项目目标

为 Linux 宿主提供一个“将不可信应用迁移到 KVM MicroVM 执行”的安全执行框架，包含：

1. **策略驱动**：面向应用/任务的安全策略（文件、网络、资源、设备）。
2. **安全编排**：将策略转译为 microVM 配置 + host 安全控制（jailer/cgroup/nftables）。
3. **审计证据链**：可追溯报告（hash、配置、资源、日志），便于合规/绩效/复现。

### 1.2 明确的功能边界（写进说明书/专利都用得上）

* 不承诺抵御未知 VM escape 0day；主张降低横向影响、提高攻击成本。
* 默认 deny-by-default：无网络、只读根、最小挂载。
* 不做 Kubernetes/CNI 全套集成（可选后续扩展，但不作为交付硬目标）。
* 不改动/不 fork hypervisor；只复用成熟 VMM（Firecracker/Cloud Hypervisor）。

---

## 2. 软著与专利的“可写性”设计

### 2.1 软著定位（建议 2 件：一主一辅）

**软著 A（主）**：`Safe-Run 策略驱动 MicroVM 安全执行系统`

* 覆盖：策略语言、校验器、转译器、执行编排、审计报告、CLI/daemon、测试、文档生成器等核心自研代码。
* 价值：功能完整、代码量可控、原创性强。

**软著 B（辅，可选）**：`Safe-Run EvidenceChain 审计取证与合规模块`

* 覆盖：证据链格式、hash/签名（可选）、运行快照、事件时间线、报告归档/检索工具。
* 价值：独立模块、可单独交付，容易形成第二件软著。

> 若你只想做 1 件软著：把 B 合并进 A 即可。

### 2.2 专利定位（建议“方法 + 系统”表述）

**专利题目方向（草案）**：
《一种面向 Linux 应用的策略驱动 MicroVM 安全执行与证据链生成方法、系统及装置》

**核心创新点（要能落地）**：

1. **策略到“可证明安全姿态”的转译**：

   * 将高层策略（网络/挂载/资源）编译为“不可表达危险状态”的配置（例如默认无网；开网需显式 allowlist；挂载需 canonicalize + 白名单前缀；组合约束禁止某些危险搭配）。
2. **执行前-执行中-执行后证据链闭环**：

   * 运行前：固化 artifacts hash（kernel/rootfs/policy/command）
   * 运行中：资源/事件采样（cgroup、VMM events）
   * 运行后：生成结构化报告与归档，并可验证一致性（hash链/签名可选）
3. **最小特权编排**：

   * 将高权限操作封装成受控 helper 或受限 sudoers，保证编排器在低权限下运行，降低自身成为攻击入口的风险。

> 这些点组合起来，较容易写出“技术效果”：
> *降低不可信应用对宿主影响、降低误配置带来的安全回退、提升可追溯性与可审计性。*

---

## 3. 技术路线（固定开源依赖，保证风险可控）

* 虚拟化：KVM
* VMM：Firecracker（首选），备选 Cloud Hypervisor
* 隔离：jailer
* host 控制：cgroup v2、nftables（M3 开始）
* 自研：Rust（禁止 unsafe 为默认门禁），serde 配置，tracing 日志

---

## 4. 工作量评估

> 假设：你每周能稳定投入 8–12 小时，持续 3–4 个月（碎片时间也可）；AI 负责产出大部分代码与文档，你负责接口设计、验收测试、安全审阅、集成排障。

### 4.1 关键难点与风险系数

* **启动 microVM + 生命周期**：中等（接口明确，但环境坑多）
* **rootfs/kernel artifacts 复现**：中等偏上（依赖打包与兼容性）
* **路径/挂载安全**：中等（需要认真写校验与测试）
* **网络白名单**：中等偏上（nftables/网卡/tap 细节）
* **证据链审计**：中等（结构化输出 + hash 计算 + 归档）

### 4.2 人日估算（保守/可交付）

**M0–M1（跑通 + 策略 + 报告）**：12–18 人日

* AI 贡献约 60–70%：代码骨架、serde、CLI、报告结构、测试模板
* 你贡献约 30–40%：环境打通、接口定稿、安全门禁、集成测试、排坑

**M2（挂载与路径安全完善 + 演示）**：8–12 人日

* 主要是校验规则与测试用例，适合 AI 批量生成测试，你做审阅与补洞

**M3（网络白名单）**：8–14 人日

* 环境差异较大，可能要反复调；建议留缓冲

**M4（可交付打磨 + 文档 + 打包）**：8–12 人日

**总计**：36–56 人日（约 2–4 个月的业余推进强度）

* 若你每周 8–12 小时，整体 12–16 周基本够
* 若每周 <6 小时，建议只做无网版本（依然可软著+专利，但专利“效果”稍弱，需要靠证据链与组合约束补足）

---

## 5. 里程碑与“可用于申报”的节点产出

### 里程碑 M1（第 4 周左右）：软著 A 基本成型

* `safe-run` CLI + policy + validate + runner + run_report.json
* 3 个演示脚本（无网、只读、资源限制）
* 文档初版（README + DESIGN + SECURITY）
* 这时就能开始整理软著材料（代码清单、功能说明、界面截图/命令输出）

### 里程碑 M3（第 10–12 周左右）：专利素材齐全

* 网络白名单、组合约束、证据链闭环
* 可形成“方法步骤图 + 系统结构图 + 技术效果对比实验”
* 适合启动专利撰写（你可请 AI 协助写草稿，你负责把关与调整表述）

### 里程碑 M4（第 14–16 周）：第二软著可独立

* 将 EvidenceChain/归档/检索工具抽成独立模块或子命令集
* 文档与用例完整，形成软著 B

---

## 6. 交付形态（避免“只是脚本拼装”的观感）

* 一个主二进制：`safe-run`
* 子命令：

  * `safe-run run ...`
  * `safe-run validate policy.yaml`
  * `safe-run artifact build`（可选）
  * `safe-run report verify run_report.json`（可选，强化证据链）
* 配套：

  * `policy.yaml`（schema 明确）
  * `run_report.json`（字段稳定）

---

## 附录 A：产出内容划分（软著 / 专利 / 交付件）

### A1. 自研代码模块划分（可用于软著“代码组成说明”）

1. **Policy & Validator（策略解析与合法性证明）**

   * policy schema（YAML/JSON）
   * 校验：默认拒绝、组合约束、上限与白名单
2. **Compiler / Translator（策略→VM/Host 配置转译）**

   * Firecracker 配置生成（结构化 JSON via serde）
   * cgroup/nftables 配置生成（模板化、非拼 shell）
3. **Runner（生命周期与最小特权编排）**

   * jailer 调用、socket API、运行监控、异常清理
4. **EvidenceChain（审计证据链）**

   * artifacts hash、命令 hash、配置摘要、事件时间线
   * 报告生成、验证（可选签名/链式 hash）
5. **CLI/UX & Ops**

   * 参数、错误码、日志、排障提示
6. **Tests & Examples**

   * 单元测试、集成测试、演示脚本、回归

### A2. 拟申报软件著作权（建议）

* **软著 A（必做）**：Safe-Run 策略驱动 MicroVM 安全执行系统

  * 覆盖：A1 的 1–6 全部（主程序完整交付）
* **软著 B（可选）**：Safe-Run EvidenceChain 审计取证与合规工具

  * 覆盖：A1 的 4 + 5 + 6（独立工具/库化、可单独运行）

### A3. 拟申报专利（建议 1 件）

* **专利名称（草案）**：一种策略驱动的 MicroVM 安全执行与证据链生成方法、系统及装置
* **权利要求点（草案拆分）**：

  1. 一种将高层策略编译为 microVM 与宿主约束配置的方法（含组合约束与默认拒绝）
  2. 一种运行前后证据链生成与一致性校验方法（hash 固化、报告结构、验证）
  3. 一种最小特权编排方法（受控高权限操作封装）
* **附图建议**：

  * 系统架构图（policy→compiler→runner→VMM→report）
  * 方法流程图（输入策略→校验→转译→执行→采样→报告→验证）
  * 技术效果对比图（宿主运行 vs microVM 运行 的风险面）

### A4. 对外交付件（可演示、可验收）

* `safe-run` 二进制 + 示例 policy
* 固化 artifacts（kernel/rootfs）或构建脚本
* `run_report.json` 输出样例
* `examples/` 演示：无网、只读、资源限制、（可选）白名单联网
* 文档四件套：README / DESIGN / SECURITY / OPERATIONS
